# Author: P3TERX (Modified and Optimized)
#=================================================
name: ğŸ’» Build OpenWrt (x86_64)
# ============================================
# è§¦å‘æ¡ä»¶
# ============================================
on:
  workflow_dispatch:
    inputs:
      lan_addr:
        description: "ğŸ“ é»˜è®¤ LAN åœ°å€"
        default: "192.168.1.10"
        required: true
        type: string
      root_password:
        description: "ğŸ”‘ Root å¯†ç "
        default: "password"
        required: false
        type: string
      docker:
        description: "ğŸ‹ Docker æ”¯æŒ"
        type: boolean
        default: true
      passwall:
        description: "ğŸŒ Passwall"
        type: boolean
        default: true
      nikki:
        description: "ğŸ“¦ Nikki"
        type: boolean
        default: true
      openclash:
        description: "âš¡ OpenClash"
        type: boolean
        default: true
      use_cache:
        description: "ğŸ’¾ ä½¿ç”¨ç¼“å­˜åŠ é€Ÿ"
        type: boolean
        default: true
      debug_mode:
        description: "ğŸ› è°ƒè¯•æ¨¡å¼"
        type: boolean
        default: false
      parallel_jobs:
        description: "ğŸ”¢ å¹¶è¡Œä»»åŠ¡æ•° (0=è‡ªåŠ¨)"
        type: string
        default: "0"
      force_clean:
        description: "ğŸ§¹ å¼ºåˆ¶æ¸…ç†ç¼“å­˜"
        type: boolean
        default: false
# ============================================
# å…¨å±€ç¯å¢ƒå˜é‡
# ============================================
env:
  # æºç ä»“åº“
  REPO_URL: https://github.com/openwrt/openwrt
  REPO_BRANCH: openwrt-24.10
  
  # é…ç½®æ–‡ä»¶
  CONFIG_FILE: configs/x86_64.config
  DIY_SCRIPT: scripts/diy-x86_64_demo.sh
  FEEDS_CONF: feeds.conf.default
  
  # ç¼–è¯‘è®¾ç½®
  CLASH_KERNEL: amd64
  CACHE_TOOLCHAIN: true
  UPLOAD_BIN_DIR: false
  FIRMWARE_RELEASE: true
  FIRMWARE_TAG: X86_64
  
  # ç³»ç»Ÿè®¾ç½®
  TZ: Asia/Shanghai
  DEBIAN_FRONTEND: noninteractive
# ============================================
# å¹¶å‘æ§åˆ¶
# ============================================
concurrency:
  group: build-${{ github.ref }}-${{ github.event.inputs.lan_addr }}
  cancel-in-progress: false
# ============================================
# ä¸»ä»»åŠ¡
# ============================================
jobs:
  build:
    name: ğŸ—ï¸ Build OpenWrt
    runs-on: ubuntu-24.04
    timeout-minutes: 720
    
    outputs:
      firmware_path: ${{ steps.organize.outputs.firmware_path }}
      kernel_version: ${{ steps.organize.outputs.kernel_version }}
    
    steps:
      # ============================================
      # 1. åˆå§‹åŒ–
      # ============================================
      - name: ğŸ”§ Setup Environment
        id: env
        run: |
          # æ—¶åŒºè®¾ç½®
          sudo timedatectl set-timezone "$TZ"
          
          # Git é…ç½®
          git config --global user.name 'github-actions[bot]'
          git config --global user.email 'github-actions[bot]@users.noreply.github.com'
          
          # ç”Ÿæˆæ„å»ºä¿¡æ¯
          VERSION=$(date +'%Y.%m.%d')
          DATE=$(date +'%Y-%m-%d %H:%M:%S')
          BUILD_ID="${{ github.run_number }}-${GITHUB_SHA::7}"
          FILE_DATE=$(date +'%Y.%m.%d-%H%M')
          TAG_TIME=$(date +'%Y.%m.%d')
          
          # ç³»ç»Ÿä¿¡æ¯
          PROC_COUNT=$(nproc)
          MEM_GB=$(($(free -m | awk '/^Mem:/{print $2}') / 1024))
          
          # è®¡ç®—å¹¶è¡Œä»»åŠ¡æ•°
          if [ "${{ github.event.inputs.parallel_jobs }}" = "0" ]; then
            JOBS=$((MEM_GB / 2))
            JOBS=$((JOBS > PROC_COUNT ? PROC_COUNT : JOBS))
            JOBS=$((JOBS < 1 ? 1 : JOBS))
          else
            JOBS="${{ github.event.inputs.parallel_jobs }}"
          fi
          
          # è°ƒè¯•æ¨¡å¼
          if [[ "${{ github.event.inputs.debug_mode }}" == "true" ]]; then
            BUILD_FLAGS="V=s"
          else
            BUILD_FLAGS=""
          fi
          
          # è¾“å‡ºç¯å¢ƒå˜é‡
          cat << EOF >> $GITHUB_ENV
          BUILD_VERSION=$VERSION
          BUILD_DATE=$DATE
          BUILD_ID=$BUILD_ID
          FILE_DATE=$FILE_DATE
          TAG_TIME=$TAG_TIME
          PROC_COUNT=$PROC_COUNT
          MEM_GB=$MEM_GB
          COMPILE_JOBS=$JOBS
          BUILD_FLAGS=$BUILD_FLAGS
          EOF
          
          # è®¾ç½®ç¼“å­˜é”®
          CACHE_KEY="openwrt-${{ env.REPO_BRANCH }}-x86_64-$(date +'%Y%m')"
          echo "CACHE_KEY=$CACHE_KEY" >> $GITHUB_ENV
          
      - name: ğŸ“Š Display System Information
        run: |
          cat << EOF
          =====================================
          ğŸ“Š System Information
          =====================================
          CPU Model: $(lscpu | grep 'Model name' | cut -d':' -f2 | xargs)
          CPU Cores: ${{ env.PROC_COUNT }}
          Memory: ${{ env.MEM_GB }}GB
          Compile Jobs: ${{ env.COMPILE_JOBS }}
          Kernel: $(uname -r)
          OS: $(lsb_release -ds)
          Build Version: ${{ env.BUILD_VERSION }}
          Build ID: ${{ env.BUILD_ID }}
          =====================================
          EOF
          
      # ============================================
      # 2. ç£ç›˜ç©ºé—´ä¼˜åŒ–
      # ============================================
      - name: ğŸ§¹ Free Disk Space
        uses: sbwml/actions@free-disk
          
      - name: ğŸ’¾ Setup Swap & Memory Optimization
        run: |
          # åˆ›å»º swap
          sudo fallocate -l 8G /swapfile
          sudo chmod 600 /swapfile
          sudo mkswap /swapfile
          sudo swapon /swapfile
          
          # ä¼˜åŒ–å†…å­˜ç®¡ç†
          cat << EOF | sudo tee -a /etc/sysctl.conf
          vm.swappiness=10
          vm.vfs_cache_pressure=50
          vm.dirty_ratio=15
          vm.dirty_background_ratio=5
          vm.max_map_count=262144
          EOF
          sudo sysctl -p
          
          echo "Memory status:"
          free -h
          df -h
      
      # ============================================
      # 3. ä»£ç æ£€å‡º
      # ============================================
      - name: âœ… Checkout Repository
        uses: actions/checkout@v4
        with:
          fetch-depth: 1
              
      # ============================================
      # 4. ä¼˜åŒ–çš„ç¼“å­˜ç­–ç•¥ï¼ˆå‡å°‘ç¼“å­˜å¤§å°ï¼‰
      # ============================================
      - name: ğŸ’¾ Cache Downloads Only
        if: github.event.inputs.use_cache == 'true'
        uses: actions/cache@v4
        with:
          path: openwrt/dl
          key: downloads-${{ env.CACHE_KEY }}-${{ hashFiles('configs/*.config') }}
          restore-keys: |
            downloads-${{ env.CACHE_KEY }}-
            downloads-openwrt-${{ env.REPO_BRANCH }}-
            
      - name: ğŸ’¾ Cache Feeds
        if: github.event.inputs.use_cache == 'true'
        uses: actions/cache@v4
        with:
          path: |
            openwrt/feeds
            openwrt/feeds.conf.default
          key: feeds-${{ env.CACHE_KEY }}-${{ hashFiles('feeds.conf.default') }}
          restore-keys: |
            feeds-${{ env.CACHE_KEY }}-
            feeds-openwrt-${{ env.REPO_BRANCH }}-
            
      # ä»…åœ¨éå¼ºåˆ¶æ¸…ç†æ—¶ä½¿ç”¨å·¥å…·é“¾ç¼“å­˜
      - name:  ğŸ’¾ Cache Essential Host Tools
        uses: actions/cache@v4
        with:
          path: |
            openwrt/staging_dir/host/bin
            openwrt/staging_dir/host/include
          key: host-tools-${{ env.CACHE_KEY }}-${{ hashFiles('configs/*.config') }}
            
      # ============================================
      # 5. ç¯å¢ƒå®‰è£…
      # ============================================
      - name: Build System Setup
        uses: sbwml/actions@openwrt-build-setup
            
      - name: ğŸ“¦ Install LLVM
        uses: sbwml/actions@install-llvm
        
      # ============================================
      # 6. æºç å¤„ç†
      # ============================================
      - name: ğŸ“¥ Prepare OpenWrt Source
        run: |
          if [ ! -d "openwrt" ] || [ "${{ github.event.inputs.force_clean }}" = "true" ]; then
            echo "ğŸ”„ Cloning OpenWrt source..."
            rm -rf openwrt
            git clone --depth=1 "$REPO_URL" -b "$REPO_BRANCH" openwrt
          else
            echo "âœ… Using cached OpenWrt source"
            cd openwrt
            git fetch --depth=1 origin $REPO_BRANCH
            git reset --hard FETCH_HEAD
            git clean -fd
          fi
          
          cd openwrt
          echo "OPENWRT_PATH=$PWD" >> $GITHUB_ENV
          
          # è·å–æäº¤ä¿¡æ¯
          COMMIT_INFO=$(git log -1 --pretty=format:'%an|%ci|%s|%H')
          IFS='|' read -r AUTHOR DATE MESSAGE HASH <<< "$COMMIT_INFO"
          
          cat << EOF >> $GITHUB_ENV
          COMMIT_AUTHOR=$AUTHOR
          COMMIT_DATE=$DATE
          COMMIT_MESSAGE=$MESSAGE
          COMMIT_HASH=$HASH
          EOF
          
      # ============================================
      # 7. Feeds é…ç½®
      # ============================================
      - name: ğŸ“š Configure Feeds
        run: |
          cd $OPENWRT_PATH
          
          # å¤åˆ¶ feeds é…ç½®
          if [ -f "${{ github.workspace }}/feeds.conf.default" ]; then
            cp ${{ github.workspace }}/feeds.conf.default .
          fi
          
          # æ›´æ–° feeds
          ./scripts/feeds update -a
          ./scripts/feeds install -a
          
      # ============================================
      # 8. è‡ªå®šä¹‰é…ç½®
      # ============================================
      - name: ğŸ¨ Apply Custom Configuration
        env:
          LAN: ${{ github.event.inputs.lan_addr }}
          ROOT_PASSWORD: ${{ github.event.inputs.root_password }}
          ENABLE_DOCKER: ${{ github.event.inputs.docker }}
          ENABLE_PASSWALL: ${{ github.event.inputs.passwall }}
          ENABLE_NIKKI: ${{ github.event.inputs.nikki }}
          ENABLE_OPENCLASH: ${{ github.event.inputs.openclash }}
        run: |
          cd $OPENWRT_PATH
          
          # å¤åˆ¶è‡ªå®šä¹‰æ–‡ä»¶
          [ -e ${{ github.workspace }}/files ] && cp -r ${{ github.workspace }}/files .
          
          # å¤åˆ¶é…ç½®æ–‡ä»¶
          cp ${{ github.workspace }}/${CONFIG_FILE} .config
          
          # æ‰§è¡Œè‡ªå®šä¹‰è„šæœ¬
          if [ -f "${{ github.workspace }}/scripts/diy-x86_64_demo.sh" ]; then
            chmod +x ${{ github.workspace }}/scripts/diy-x86_64_demo.sh
            ${{ github.workspace }}/scripts/diy-x86_64_demo.sh
          fi
          
          if [ -f "${{ github.workspace }}/scripts/preset-mihimo-core.sh" ]; then
            chmod +x ${{ github.workspace }}/scripts/preset-mihimo-core.sh
            ${{ github.workspace }}/scripts/preset-mihimo-core.sh $CLASH_KERNEL
          fi
          
          if [ -f "${{ github.workspace }}/scripts/preset-adguard-core.sh" ]; then
            chmod +x ${{ github.workspace }}/scripts/preset-adguard-core.sh
            ${{ github.workspace }}/scripts/preset-adguard-core.sh $CLASH_KERNEL
          fi
          
          # ç”Ÿæˆæœ€ç»ˆé…ç½®
          make defconfig
          
          # æå–è®¾å¤‡ä¿¡æ¯
          DEVICE_TARGET=$(grep '^CONFIG_TARGET_BOARD=' .config | cut -d'"' -f2 2>/dev/null || echo "x86")
          DEVICE_SUBTARGET=$(grep '^CONFIG_TARGET_SUBTARGET=' .config | cut -d'"' -f2 2>/dev/null || echo "64")
          
          echo "DEVICE_TARGET=$DEVICE_TARGET" >> $GITHUB_ENV
          echo "DEVICE_SUBTARGET=$DEVICE_SUBTARGET" >> $GITHUB_ENV
          
      # ============================================
      # 9. æ¸…ç†æ„å»ºç›®å½•ï¼ˆå¦‚æœéœ€è¦ï¼‰
      # ============================================
      - name: ğŸ§¹ Clean Build Directory
        if: steps.cache.outputs.cache-hit != 'true'
        run: |
          cd $OPENWRT_PATH
          echo "ç¼“å­˜æœªå‘½ä¸­ï¼Œç¡®ä¿ä¸€ä¸ªå¹²å‡€çš„æ„å»ºç¯å¢ƒ..."
          rm -rf build_dir tmp
          make defconfig  
          
      # ============================================
      # 10. ä¸‹è½½ä¾èµ–åŒ…
      # ============================================
      - name: ğŸ“¥ Download Packages
        run: |
          cd $OPENWRT_PATH
          
          echo "ğŸ“¥ Starting package download..."
          make download -j$((COMPILE_JOBS + 1))
          
          # æ£€æŸ¥å¤±è´¥çš„ä¸‹è½½
          echo "ğŸ” Checking for failed downloads..."
          find dl -size -1024c -exec ls -l {} \;
          find dl -size -1024c -exec rm -f {} \;
          
          # é‡è¯•ä¸‹è½½
          make download -j1 || true
          
          echo "âœ… Download completed"
          
      # ============================================
      # 11. ç¼–è¯‘å›ºä»¶
      # ============================================
      - name: ğŸ”¨ Compile Firmware
        id: compile
        timeout-minutes: 600
        run: |
          cd $OPENWRT_PATH
          
          # å¯ç”¨ ccache
          export USE_CCACHE=1
          export CCACHE_DIR=$PWD/.ccache
          export CCACHE_MAXSIZE=3G
          ccache -M 3G
          ccache -z
          
          echo "ğŸ”¨ Starting compilation with $COMPILE_JOBS jobs..."
          
          # æ¸è¿›å¼ç¼–è¯‘ç­–ç•¥
          compile_with_jobs() {
            local jobs=$1
            local flags="$2"
            echo "ğŸ”§ Attempting compilation with $jobs jobs, flags: $flags"
            
            if timeout 540m make -j$jobs $flags 2>&1 | tee compile-$jobs.log; then
              echo "âœ… Compilation successful with $jobs jobs"
              return 0
            else
              echo "âŒ Compilation failed with $jobs jobs"
              return 1
            fi
          }
          
          # å°è¯•ä¸åŒçš„ç¼–è¯‘ç­–ç•¥
          SUCCESS=false
          
          # ç¬¬ä¸€æ¬¡ï¼šæ­£å¸¸ç¼–è¯‘
          if compile_with_jobs $COMPILE_JOBS "$BUILD_FLAGS"; then
            SUCCESS=true
          # ç¬¬äºŒæ¬¡ï¼šå‡å°‘å¹¶è¡Œåº¦
          elif compile_with_jobs $((COMPILE_JOBS/2)) "V=s"; then
            SUCCESS=true
          # ç¬¬ä¸‰æ¬¡ï¼šå•çº¿ç¨‹è¯¦ç»†è¾“å‡º
          elif compile_with_jobs 1 "V=sc"; then
            SUCCESS=true
          # ç¬¬å››æ¬¡ï¼šå¿½ç•¥é”™è¯¯ç»§ç»­
          else
            echo "âš ï¸ Attempting compilation with error tolerance..."
            make -j1 V=sc IGNORE_ERRORS=1 2>&1 | tee compile-final.log || true
            
            # æ£€æŸ¥æ˜¯å¦æœ‰å›ºä»¶ç”Ÿæˆ
            if ls bin/targets/*/*/*.img* 1> /dev/null 2>&1 || ls bin/targets/*/*/*.bin 1> /dev/null 2>&1; then
              echo "âš ï¸ Firmware generated despite some errors"
              SUCCESS=true
            fi
          fi
          
          # æ˜¾ç¤º ccache ç»Ÿè®¡
          ccache -s
          
          if [ "$SUCCESS" = "true" ]; then
            echo "status=success" >> $GITHUB_OUTPUT
          else
            echo "âŒ Compilation failed completely"
            
            # è¾“å‡ºé”™è¯¯ä¿¡æ¯
            echo "=== Latest compilation errors ==="
            find . -name "compile-*.log" -exec tail -n 50 {} \;
            
            echo "=== Package build errors ==="
            find logs -name "*.log" -exec echo "=== {} ===" \; -exec tail -n 20 {} \; 2>/dev/null | head -n 200
            
            exit 1
          fi
          
      # ============================================
      # 12. æ¸…ç†å¤§æ–‡ä»¶å‡å°‘ç£ç›˜ä½¿ç”¨
      # ============================================
      - name: ğŸ§¹ Clean Large Files Before Organize
        if: steps.compile.outputs.status == 'success'
        run: |
          cd $OPENWRT_PATH
          
          # æ¸…ç†ç¼–è¯‘ä¸´æ—¶æ–‡ä»¶
          rm -rf build_dir/target-*/linux-*/linux-*/.tmp* 2>/dev/null || true
          rm -rf build_dir/target-*/linux-*/tmp 2>/dev/null || true
          rm -rf staging_dir/target-*/pkginfo 2>/dev/null || true
          rm -rf tmp/.* 2>/dev/null || true
          
          # æ¸…ç†å¤§çš„æ—¥å¿—æ–‡ä»¶
          find . -name "*.log" -size +10M -delete 2>/dev/null || true
          
          # æ¸…ç† ccache
          ccache -C
          
          echo "=== Disk space after cleanup ==="
          df -h
          
      # ============================================
      # 13. æ•´ç†å›ºä»¶æ–‡ä»¶
      # ============================================
      - name: ğŸ“¦ Organize Firmware
        if: steps.compile.outputs.status == 'success'
        id: organize
        run: |
          cd $OPENWRT_PATH/bin/targets/*/*
          
          echo "=== Generated files ==="
          ls -lah
          
          # æå–å†…æ ¸ç‰ˆæœ¬
          if [ -f *.manifest ]; then
            KERNEL_VERSION=$(grep ^kernel *.manifest | head -1 | cut -d- -f2 | tr -d ' ')
          else
            KERNEL_VERSION="unknown"
          fi
          
          # ä¿å­˜é…ç½®æ–‡ä»¶
          cp $OPENWRT_PATH/.config build.config
          
          # å‹ç¼©å†…æ ¸æ¨¡å—
          if [ -d packages ]; then
            echo "ğŸ“¦ Compressing kernel modules..."
            tar -czf kernel-modules.tar.gz packages/
            rm -rf packages
          fi
          
          # æ¸…ç†ä¸å¿…è¦çš„æ–‡ä»¶
          rm -f feeds.buildinfo version.buildinfo *.manifest 2>/dev/null || true
          
          # ç”Ÿæˆå›ºä»¶ä¿¡æ¯æ–‡ä»¶
          cat > firmware_info.json << EOF
          {
            "build_date": "$BUILD_DATE",
            "build_version": "$BUILD_VERSION",
            "build_id": "$BUILD_ID",
            "kernel_version": "$KERNEL_VERSION",
            "target": "$DEVICE_TARGET",
            "subtarget": "$DEVICE_SUBTARGET",
            "lan_address": "${{ github.event.inputs.lan_addr }}",
            "commit_hash": "$COMMIT_HASH",
            "plugins": {
              "docker": ${{ github.event.inputs.docker }},
              "passwall": ${{ github.event.inputs.passwall }},
              "openclash": ${{ github.event.inputs.openclash }},
              "nikki": ${{ github.event.inputs.nikki }}
            }
          }
          EOF
          
          # ç”ŸæˆREADME
          cat > README.md << EOF
          # OpenWrt Firmware
          
          **Build ID:** $BUILD_ID  
          **Build Date:** $BUILD_DATE  
          **Target:** $DEVICE_TARGET-$DEVICE_SUBTARGET  
          **Kernel:** $KERNEL_VERSION  
          
          ## Configuration
          - **LAN IP:** ${{ github.event.inputs.lan_addr }}
          - **Root Password:** ${{ github.event.inputs.root_password }}
          
          ## Plugins
          - Docker: ${{ github.event.inputs.docker }}
          - Passwall: ${{ github.event.inputs.passwall }}
          - OpenClash: ${{ github.event.inputs.openclash }}
          - Nikki: ${{ github.event.inputs.nikki }}
          EOF
          
          echo "firmware_path=$PWD" >> $GITHUB_OUTPUT
          echo "kernel_version=$KERNEL_VERSION" >> $GITHUB_OUTPUT
          echo "KERNEL_VERSION=$KERNEL_VERSION" >> $GITHUB_ENV
          echo "FIRMWARE_PATH=$PWD" >> $GITHUB_ENV
          
          echo "âœ… Firmware organized in: $PWD"
          
      # ============================================
      # 14. ä¸Šä¼  Artifacts
      # ============================================
      - name: ğŸ“¤ Upload Firmware
        if: steps.compile.outputs.status == 'success' && env.FIRMWARE_RELEASE != 'true'
        uses: actions/upload-artifact@v4
        with:
          name: OpenWrt-${{ env.DEVICE_TARGET }}-${{ env.FILE_DATE }}
          path: ${{ env.FIRMWARE_PATH }}
          retention-days: 30
          compression-level: 6
          
      # ============================================
      # 15. åˆ›å»º Release
      # ============================================
      - name: ğŸš€ Create Release
        if: steps.compile.outputs.status == 'success' && env.FIRMWARE_RELEASE == 'true'
        uses: ncipollo/release-action@v1
        with:
          name: ${{ env.FILE_DATE }}-OpenWrt-${{ env.FIRMWARE_TAG }}
          tag: ${{ env.FIRMWARE_TAG }}-${{ env.BUILD_VERSION }}
          allowUpdates: true
          removeArtifacts: false
          replacesArtifacts: true
          token: ${{ secrets.GITHUB_TOKEN }}
          artifacts: ${{ env.FIRMWARE_PATH }}/*
          body: |
            ## ğŸ¯ OpenWrt Firmware [${{ env.BUILD_ID }}]
            
            ### ğŸ“Š æ„å»ºä¿¡æ¯
            | é¡¹ç›® | ä¿¡æ¯ |
            |------|------|
            | **ç‰ˆæœ¬** | `${{ env.BUILD_VERSION }}` |
            | **æ—¥æœŸ** | `${{ env.BUILD_DATE }}` |
            | **ç›®æ ‡** | `${{ env.DEVICE_TARGET }}-${{ env.DEVICE_SUBTARGET }}` |
            | **å†…æ ¸** | `${{ env.KERNEL_VERSION }}` |
            | **LAN IP** | `${{ github.event.inputs.lan_addr }}` |
            | **å¯†ç ** | `${{ github.event.inputs.root_password }}` |
            
            ### ğŸ“¦ åŒ…å«çš„æ’ä»¶
            | æ’ä»¶ | çŠ¶æ€ |
            |------|------|
            | Docker | ${{ github.event.inputs.docker == 'true' && 'âœ… å·²å¯ç”¨' || 'âŒ æœªå¯ç”¨' }} |
            | Passwall | ${{ github.event.inputs.passwall == 'true' && 'âœ… å·²å¯ç”¨' || 'âŒ æœªå¯ç”¨' }} |
            | OpenClash | ${{ github.event.inputs.openclash == 'true' && 'âœ… å·²å¯ç”¨' || 'âŒ æœªå¯ç”¨' }} |
            | Nikki | ${{ github.event.inputs.nikki == 'true' && 'âœ… å·²å¯ç”¨' || 'âŒ æœªå¯ç”¨' }} |
            
            ### ğŸ“ æºç ä¿¡æ¯
            - **ä»“åº“**: [${{ env.REPO_URL }}](${{ env.REPO_URL }})
            - **åˆ†æ”¯**: `${{ env.REPO_BRANCH }}`
            - **æäº¤**: `${{ env.COMMIT_HASH }}`
            - **ä½œè€…**: ${{ env.COMMIT_AUTHOR }}
            - **æ—¶é—´**: ${{ env.COMMIT_DATE }}
            - **æ¶ˆæ¯**: ${{ env.COMMIT_MESSAGE }}
            
            ### ğŸ“¥ å®‰è£…è¯´æ˜
            ```bash
            # è§£å‹å›ºä»¶
            gunzip openwrt-*.img.gz
            
            # å†™å…¥è®¾å¤‡ (è¯·æ›¿æ¢ /dev/sdX ä¸ºå®é™…è®¾å¤‡)
            sudo dd if=openwrt-*.img of=/dev/sdX bs=4M status=progress
